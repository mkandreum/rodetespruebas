
import { showInfoModal, showLoading } from '../ui.js';

export async function handleDownloadTicket() {
    // Element to capture
    const element = document.getElementById('ticket-node-to-download') || document.getElementById('ticket-modal-content'); // Adjust ID as needed from HTML
    // Actually in app.js it was `ticketToDownload` variable which selected #ticket-modal-content > div (the ticket visual)
    const target = document.querySelector('#ticket-modal .border-4'); // Finding the visible ticket card
    
    if (!target || typeof html2canvas === 'undefined') {
        showInfoModal("Error de descarga (Librer√≠a faltante o elemento).", true);
        return;
    }
    
    const btn = document.getElementById('download-ticket-btn');
    const holderName = btn?.dataset.holderName || 'ticket';
    const eventName = btn?.dataset.eventName || 'evento';
    
    showLoading(true);
    try {
        const canvas = await html2canvas(target, { scale: 2, backgroundColor: "#000000" });
        const link = document.createElement('a');
        link.download = `entrada_rodetes_${holderName}_${eventName}.png`.replace(/\s+/g, '_');
        link.href = canvas.toDataURL('image/png');
        link.click();
    } catch(e) {
        showInfoModal("Error creando imagen: " + e.message, true);
    } finally {
        showLoading(false);
    }
}

// ... Previous exports ...
// I will just append this function to the file `js/features/tickets.js` using regular write_to_file with full content to be safe
// as I can't append. I will rewrite tickets.js one last time.
